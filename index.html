<!DOCTYPE html>
<html> 
<head> 
  <meta http-equiv="content-type" content="text/html; charset=UTF-8" /> 
  <meta name="viewport" content="width=device-width">
  <title>Auction Result Passin House Map VIC Melbourne Australia</title> 
  <style type="text/css">
  html, body { height:100%; width:100%; margin: 0px; padding: 0px}
  </style>
  <!--
  <script src="http://maps.google.com/maps/api/js?sensor=false" type="text/javascript"></script>
  -->
  <script src="https://maps.googleapis.com/maps/api/js"></script>
  <style>
    #legend {
      padding: 10px;
    }
  </style>
</head> 
<body>
  <div id="legend">
      <form id="select_form">
        <select id="state_list">
          <option value="vic" selected="selected">VIC</option>
          <option value="nsw">NSW</option>
        </select>
        <select id="date_list">
          <option value="2015/December/6" selected="selected">2015/December/6</option>
          <option value="2015/November/29">2015/November/29</option>
        </select>
      </form>
  </div>
  <div id="map" style="width:100%; height:100%;"></div>

  <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
  <script type="text/javascript">

    var map;

    function initialize() {
        map = new google.maps.Map(document.getElementById('map'), {
          zoom: 12,
          center: new google.maps.LatLng(-37.8180, 144.9760),
          streetViewControl: true,
          scaleControl: true, 
          mapTypeControlOptions: {
            style: google.maps.MapTypeControlStyle.HORIZONTAL_BAR,
            position: google.maps.ControlPosition.BOTTOM_CENTER
          },
          mapTypeId: google.maps.MapTypeId.ROADMAP
        });

    }

    var markers  = [];
    var i;

    function clean_markers() {
      //console.log(markers.length);
      for (var i = 0; i < markers.length; i++) {
        markers[i].setMap(null);
      }

      markers = [];
    }

    $('#date_list').on('change', function() {
      //console.log("data/"+$('#state_list').val()+"/"+this.value+"/show.js");
      clean_markers();
      initialize();

      var infowindow = new google.maps.InfoWindow();


      $.getScript( "data/"+$('#state_list').val()+"/"+this.value+"/show.js", function( data, textStatus, jqxhr ) {
        //console.log( data ); // Data returned
        //console.log( textStatus ); // Success
        //console.log( jqxhr.status ); // 200
        //console.log( "Load was performed." );


        for (i = 0; i < locations.length; i++) {  
          var marker = new google.maps.Marker({
            position: new google.maps.LatLng(locations[i][1], locations[i][2]),
            map: map
          });

          markers.push(marker);

          google.maps.event.addListener(marker, 'click', (function(marker, i) {
            return function() {
              infowindow.setContent(locations[i][0]);
              infowindow.open(map, marker);
            }
          })(marker, i));
        }

        google.maps.event.trigger(map, 'resize');

      });
    });

    $( "#date_list" ).trigger( "change" );
    map.controls[google.maps.ControlPosition.TOP_CENTER].push(document.getElementById('legend'));

    console.log("version: 1.8");
  </script>
</body>
</html>
